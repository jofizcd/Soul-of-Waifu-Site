<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate-key="pageTitle">Лорбуки - Документация Soul of Waifu</title>
    <link rel="icon" type="image/x-icon" href="../../../assets/icons/logotype.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        :root {
            /* Dark Theme Colors */
            --dark-primary: #4361ee;
            --dark-primary-dark: #3a56d4;
            --dark-primary-light: #4868ff;
            --dark-secondary: #7209b7;
            --dark-accent: #4cc9f0;
            --dark-dark: #0f172a;
            --dark-darker: #0c1221;
            --dark-darkest: #080c16;
            --dark-light: #f1f5f9;
            --dark-gray: #94a3b8;
            --dark-card-bg: rgba(30, 41, 59, 0.7);
            --dark-card-border: rgba(71, 85, 105, 0.5);
            --dark-section-bg: rgba(15, 23, 42, 0.6);
            --dark-code-bg: #1e293b;
            --dark-hover: rgba(67, 97, 238, 0.15);

            /* Light Theme Colors */
            --light-primary: #4361ee;
            --light-primary-dark: #3a56d4;
            --light-primary-light: #4868ff;
            --light-secondary: #7209b7;
            --light-accent: #4cc9f0;
            --light-dark: #0f172a;
            --light-darker: #0c1221;
            --light-darkest: #080c16;
            --light-light: #f8fafc;
            --light-gray: #64748b;
            --light-card-bg: rgba(255, 255, 255, 0.9);
            --light-card-border: rgba(203, 213, 225, 0.8);
            --light-section-bg: rgba(241, 245, 249, 0.8);
            --light-code-bg: #f1f5f9;
            --light-hover: rgba(67, 97, 238, 0.1);

            /* Current Theme */
            --primary: var(--dark-primary);
            --primary-dark: var(--dark-primary-dark);
            --primary-light: var(--dark-primary-light);
            --secondary: var(--dark-secondary);
            --accent: var(--dark-accent);
            --dark: var(--dark-dark);
            --darker: var(--dark-darker);
            --darkest: var(--dark-darkest);
            --light: var(--dark-light);
            --gray: var(--dark-gray);
            --card-bg: var(--dark-card-bg);
            --card-border: var(--dark-card-border);
            --section-bg: var(--dark-section-bg);
            --code-bg: var(--dark-code-bg);
            --hover: var(--dark-hover);
        }
        body {
            background: linear-gradient(135deg, var(--darker), var(--darkest));
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }
        body.light-theme {
            --primary: var(--light-primary);
            --primary-dark: var(--light-primary-dark);
            --primary-light: var(--light-primary-light);
            --secondary: var(--light-secondary);
            --accent: var(--light-accent);
            --dark: var(--light-dark);
            --darker: var(--light-darker);
            --darkest: var(--light-darkest);
            --light: var(--light-dark);
            --gray: var(--light-gray);
            --card-bg: var(--light-card-bg);
            --card-border: var(--light-card-border);
            --section-bg: var(--light-section-bg);
            --code-bg: var(--light-code-bg);
            --hover: var(--light-hover);
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            color: var(--dark);
        }
        header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--card-border);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        body.light-theme header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid var(--card-border);
        }
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 10px;
        }
        .logo-icon {
            width: 40px;
            height: 40px;
            position: relative;
        }
        .logo a {
            display: flex;
            align-items: center;
            text-decoration: none;
        }
        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--light);
            text-decoration: none;
        }
        body.light-theme .logo-text {
            color: var(--dark);
        }
        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .social-icons {
            display: flex;
            gap: 0.5rem;
        }
        .social-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s ease;
            border: 1px solid var(--card-border);
        }
        body.light-theme .social-icon {
            background: rgba(255, 255, 255, 0.8);
            color: var(--dark);
        }
        .social-icon:hover {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .theme-language-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        .theme-toggle {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            width: 50px;
            height: 25px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .theme-toggle-slider {
            position: absolute;
            top: 1px;
            left: 1px;
            width: 21px;
            height: 21px;
            background: var(--primary-light);
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        body.light-theme .theme-toggle-slider {
            transform: translateX(25px);
        }
        .language-selector {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 0.3rem 0.8rem;
            color: var(--light);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        body.light-theme .language-selector {
            color: var(--dark);
        }
        .doc-container {
            display: flex;
            min-height: 100vh;
            padding-top: 78px;
        }
        .doc-sidebar {
            width: 280px;
            background: var(--card-bg);
            border-right: 1px solid var(--card-border);
            padding: 2rem 1rem;
            position: fixed;
            height: calc(100vh - 76px);
            overflow-y: auto;
            transition: all 0.3s ease;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-light) var(--card-bg);
        }
        .doc-sidebar::-webkit-scrollbar {
            width: 8px;
        }
        .doc-sidebar::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 4px;
        }
        .doc-sidebar::-webkit-scrollbar-thumb {
            background-color: var(--primary-light);
            border-radius: 4px;
            border: 2px solid var(--card-bg);
        }
        .doc-sidebar h3 {
            color: var(--primary-light);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--card-border);
            font-size: 1.1rem;
        }
        .doc-sidebar ul {
            list-style: none;
            margin-bottom: 2rem;
        }
        .doc-sidebar ul li {
            margin-bottom: 0.3rem;
        }
        .doc-sidebar a {
            color: #cbd5e1;
            text-decoration: none;
            display: block;
            padding: 0.6rem 1rem;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }
        body.light-theme .doc-sidebar a {
            color: #4a5568;
        }
        .doc-sidebar a:hover {
            background: var(--hover);
            color: var(--primary-light);
        }
        .doc-sidebar a.active {
            background: var(--primary);
            color: white !important;
        }
        body.light-theme .doc-sidebar a.active {
            color: white !important;
        }
        .doc-main {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }
        .doc-content {
            max-width: 900px;
            margin: 0 auto;
        }
        .doc-content h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: white;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--card-border);
            scroll-margin-top: 100px;
        }
        body.light-theme .doc-content h1 {
            color: var(--dark);
        }
        .doc-content h2 {
            font-size: 2rem;
            margin: 2rem 0 1rem;
            color: white;
            scroll-margin-top: 100px;
            position: relative;
            padding-left: 1.5rem;
        }
        body.light-theme .doc-content h2 {
            color: var(--dark);
        }
        .doc-content h2:before {
            content: "";
            position: absolute;
            left: 0;
            top: 0.5rem;
            width: 4px;
            height: 1.5rem;
            background: var(--primary-light);
            border-radius: 2px;
        }
        .doc-content h3 {
            font-size: 1.5rem;
            margin: 1.5rem 0 1rem;
            color: white;
            scroll-margin-top: 100px;
        }
        body.light-theme .doc-content h3 {
            color: var(--dark);
        }
        .doc-content p {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            color: #cbd5e1;
        }
        body.light-theme .doc-content p {
            color: #4a5568;
        }
        .doc-content ul, 
        .doc-content ol {
            margin: 1rem 0 1.5rem 2rem;
        }
        .doc-content li {
            margin-bottom: 0.5rem;
            line-height: 1.6;
            color: #cbd5e1;
        }
        body.light-theme .doc-content li {
            color: #4a5568;
        }
        .doc-content code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--accent);
            font-size: 0.95rem;
        }
        .doc-content pre {
            background: var(--code-bg);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            border: 1px solid var(--card-border);
            position: relative;
        }
        body.light-theme .doc-content pre {
            background: #f1f5f9;
        }
        .doc-content pre code {
            background: none;
            padding: 0;
            color: #cbd5e1;
        }
        body.light-theme .doc-content pre code {
            color: #4a5568;
        }
        .doc-content .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 4px solid var(--primary-light);
            background: rgba(67, 97, 238, 0.1);
            position: relative;
            padding-left: 3rem;
        }
        body.light-theme .doc-content .alert {
            background: rgba(67, 97, 238, 0.05);
        }
        .doc-content .alert:before {
            content: "!";
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: var(--primary-light);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .doc-content .alert-warning {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
        body.light-theme .doc-content .alert-warning {
            background: rgba(245, 158, 11, 0.05);
        }
        .doc-content .alert-warning:before {
            background: #f59e0b;
        }
        .doc-content .alert-info {
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        body.light-theme .doc-content .alert-info {
            background: rgba(59, 130, 246, 0.05);
        }
        .doc-content .alert-info:before {
            background: #3b82f6;
        }
        .doc-content .alert-important {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        body.light-theme .doc-content .alert-important {
            background: rgba(239, 68, 68, 0.05);
        }
        .doc-content .alert-important:before {
            background: #ef4444;
        }
        .model-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px;
            overflow: hidden;
        }
        .model-table th,
        .model-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }
        .model-table th {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary-light);
            font-weight: 600;
        }
        .model-table tr:last-child td {
            border-bottom: none;
        }
        body.light-theme .model-table th {
            background: rgba(67, 97, 238, 0.1);
        }
        .screenshot-container {
            text-align: center;
            margin: 1.5rem 0;
        }
        .screenshot-container img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--card-border);
        }
        .toc {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .toc h3 {
            color: var(--primary-light);
            margin-bottom: 1rem;
            margin-top: 0.5rem;
        }
        .toc ul {
            list-style: none;
            margin: 0;
        }
        .toc ul li {
            margin-bottom: 0.5rem;
        }
        .toc ul li a {
            color: var(--primary-light);
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        .toc ul li a:before {
            content: "→";
            margin-right: 0.5rem;
        }
        .pagination {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--card-border);
        }
        .pagination-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-light);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s ease;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
        }
        .pagination-link:hover {
            background: var(--hover);
        }
        .pagination-next {
            margin-left: auto;
        }
        @media (max-width: 1200px) {
            .doc-sidebar {
                width: 240px;
            }
            .doc-main {
                margin-left: 240px;
            }
        }
        @media (max-width: 992px) {
            .doc-container {
                flex-direction: column;
            }
            .doc-sidebar {
                width: 100%;
                position: relative;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--card-border);
            }
            .doc-main {
                margin-left: 0;
            }
        }
        @media (max-width: 768px) {
            header {
                padding: 1rem;
            }
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            .logo {
                align-self: flex-start;
            }
            .header-controls {
                width: 100%;
                flex-wrap: wrap;
            }
            .social-icons {
                margin-left: auto;
            }
            .theme-language-controls {
                margin-left: auto;
            }
            .doc-content h1 {
                font-size: 2rem;
            }
            .doc-content h2 {
                font-size: 1.7rem;
            }
            .doc-content h3 {
                font-size: 1.4rem;
            }
        }
        @media (max-width: 480px) {
            .social-icon span {
                display: none;
            }
            .social-icon {
                width: 32px;
                height: 32px;
            }
            .doc-content h1 {
                font-size: 1.8rem;
            }
            .doc-content h2 {
                font-size: 1.5rem;
            }
            .doc-content h3 {
                font-size: 1.3rem;
            }
            .doc-content p {
                font-size: 1rem;
            }
        }
        footer {
            background: var(--darkest);
            padding: 1rem;
            border-top: 1px solid var(--card-border);
            text-align: center;
        }
        body.light-theme footer {
            background: #f8fafc;
            border-top: 1px solid var(--card-border);
        }
        .footer-content {
            margin: auto;
            text-align: right;
            color: #94a3b8;
        }
        body.light-theme .footer-content {
            color: #718096;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .doc-content > * {
            animation: fadeIn 0.5s ease-out;
        }
        .screenshots-row {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        .screenshots-row .screenshot-container {
            flex: 1;
            margin: 0;
        }
        @media (max-width: 768px) {
            .screenshots-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <a href="../../../index.html">
                    <div class="logo-icon">
                        <img src="../../../assets/icons/logotitle.png" alt="logotype" width="160px" height="50px" class="logo-dark">
                        <img src="../../../assets/icons/logotitle_black.png" alt="logotype" width="160px" height="50px" class="logo-light" style="display: none;">
                    </div>
                </a>
            </div>
            <div class="header-controls">
                <div class="social-icons">
                    <a href="https://github.com/jofizcd/Soul-of-Waifu" class="social-icon" title="GitHub" data-translate-title="githubTitle">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="https://discord.com/invite/6vFtQGVfxM" class="social-icon" title="Discord" data-translate-title="discordTitle">
                        <i class="fab fa-discord"></i>
                    </a>
                    <a href="https://www.donationalerts.com/r/jofizcd" class="social-icon" title="Donation Alerts">
                        <i class="fa-solid fa-hand-holding-dollar"></i>
                    </a>
                </div>
                <div class="theme-language-controls">
                    <div class="theme-toggle" id="themeToggle">
                        <div class="theme-toggle-slider"></div>
                    </div>
                    <select class="language-selector" id="languageSelector">
                        <option value="ru">RU</option>
                        <option value="en">EN</option>
                    </select>
                </div>
            </div>
        </div>
    </header>
    <div class="doc-container">
        <aside class="doc-sidebar">
            <h3 class="sidebar-title" data-translate-key="sidebarTitle">Содержание</h3>
            <ul>
                <li><a href="../../overview/overview.html" class="sidebar-introduction" data-translate-key="sidebarIntroduction">Введение</a></li>
                <li><a href="../../installation/installation.html" class="sidebar-installation" data-translate-key="sidebarInstallation">Установка</a></li>
                <li><a href="../../quick-start/quickstart.html" class="sidebar-quick-start" data-translate-key="sidebarQuickStart">Быстрый старт</a></li>
                <li><a href="../../character-creation/character-creation.html" class="sidebar-character-creation" data-translate-key="sidebarCharacterCreation">Создание персонажей</a></li>
                <li><a href="../../llm-setup/llm-setup.html" class="sidebar-llm-setup" data-translate-key="sidebarLlmSetup">Настройка моделей</a></li>
                <li><a href="../../tts/tts.html" class="sidebar-tts-stt" data-translate-key="sidebarTtsStt">Озвучка</a></li>
                <li><a href="../../avatars/avatars.html" class="sidebar-avatars" data-translate-key="sidebarAvatars">Аватары персонажей</a></li>
            </ul>
            <h3 class="sidebar-course-title" data-translate-key="sidebarCourseTitle">Вводный курс в AI RP</h3>
            <ul>
                <li><a href="../about-llm/llm.html" class="sidebar-course-llm" data-translate-key="sidebarCourseLlm">Всё про LLM</a></li>
                <li><a href="../persona/persona.html" class="sidebar-course-persona" data-translate-key="sidebarCoursePersona">Персона</a></li>
                <li><a href="../system-prompt/system-prompt.html" class="sidebar-course-system-prompt" data-translate-key="sidebarCourseSystemPrompt">Системный промпт</a></li>
                <li><a href="lorebooks.html" class="sidebar-course-lorebooks active" data-translate-key="sidebarCourseLorebooks">Лорбуки</a></li>
                <li><a href="../smart-memory/smart-memory.html" class="sidebar-course-smartmemory" data-translate-key="sidebarCourseSmartMemory">Умная Память</a></li>
                <li><a href="../sow-system/sow-system.html" class="sidebar-course-soul-system" data-translate-key="sidebarCourseSoulSystem">Soul of Waifu System</a></li>
            </ul>
            <h3 class="sidebar-development-title" data-translate-key="sidebarDevelopmentTitle">Развитие программы</h3>
            <ul>
                <li><a href="../../program-support/community/community.html" class="sidebar-community" data-translate-key="sidebarCommunity">Сообщество</a></li>
                <li><a href="../../program-support/support/support.html" class="sidebar-support" data-translate-key="sidebarSupport">Поддержать автора</a></li>
            </ul>
        </aside>
        <main class="doc-main">
            <div class="doc-content">
                <h1 id="lorebooks-overview" class="doc-title" data-translate-key="docTitle">Лорбуки</h1>
                <p class="doc-intro" data-translate-key="docIntro">Лорбуки (также известные как Информация о Мире или Книги Знаний) - это мощный инструмент для динамического управления контекстом в задачах взаимодействия с языковыми моделями. Это не просто статическая энциклопедия мира, а активный компонент, который динамически вставляет релевантную информацию в промпт модели в зависимости от текущего контекста разговора. Лорбуки функционируют как динамический словарь, который активирует и вставляет соответствующую информацию только тогда, когда ключевые слова, связанные с записями, присутствуют в тексте сообщения. Представим себе лорбук о мире какого-то аниме. Если в чате проскальзывает имя персонажа или какое-то событие, то языковая модель вместо того, чтобы брать эту информацию из перегруженной карточки персонажа, вытаскивает записи из лорбука, в которых фигурирует имя или событие, а к этим записям прикреплен текст, который описывает упомянутое ранее имя, событие или что-либо другое. Таким образом мы серьезно облегчаем нагрузку на модель, ведь новые данные добавляются в контекст динамически и при ненадобности оттуда удаляются.</p>
                
                <div class="screenshot-container">
                    <img src="../../../assets/screenshots/courselorebooks.png" alt="Редактор Лорбуков" data-translate-alt="system-promptEditorScreenshotAlt">
                    <p class="screenshot-caption" data-translate-key="system-promptEditorCaption" style="margin-top: 12px; font-size: 0.95em; color: #666;">Lorebooks Editor</p>
                </div>

                <p data-translate-key="lorebooksPurpose">Лорбуки по своей природе созданы для того, чтобы:</p>
                <ol>
                    <li data-translate-key="purpose1">Добавлять в контекст чата информацию о мире, персонажах, событиях или локациях</li>
                    <li data-translate-key="purpose2">Предотвращать забывание важных деталей по мере увеличения истории чата</li>
                    <li data-translate-key="purpose3">Увеличивать погружение в ролевые игры с языковой моделью</li>
                    <li data-translate-key="purpose4">Обеспечивать более точную и соответствующую контексту генерацию текста персонажа</li>
                    <li data-translate-key="purpose5">Экономить токены контекста за счет вставки информации только по мере необходимости</li>
                </ol>
                
                <p class="alert alert-important" data-translate-key="lorebooksImportant">Важно! Наличие лорбуков не гарантирует появления определенной информации в генерируемом тексте - это зависит от способности модели использовать дополнительную информацию.</p>
                
                <h2 id="lorebooks-structure" data-translate-key="structureTitle">Структура Лорбуков</h2>
                <p data-translate-key="structureText">Лорбуки состоят из отдельных записей, каждая из которых имеет следующие компоненты:</p>
                <ul>
                    <li data-translate-key="component1"><strong>Ключи (Keys)</strong> - это список ключевых слов, которые активируют вставку записи в промпт. Ключи не чувствительны к регистру.</li>
                    <li data-translate-key="component2"><strong>Содержание записи (Entry Content)</strong> - это текст, который вставляется в промпт при активации записи. Это может быть описание локации, детали о персонаже, исторические факты, правила мира или любая другая информация, которая должна быть доступна модели при генерации ответа. Важно помнить, что содержание должно быть кратким и информативным. Поскольку общий объем контекста ограничен, рекомендуется сохранять записи лаконичными, чтобы эффективно использовать доступные токены.</li>
                    <li data-translate-key="component3"><strong>Глубина сканирования</strong> - это настройка, которая определяет число сообщений в истории чата, в которых программа будет искать ключевые слова из добавленных в лорбук записей.</li>
                </ul>
                
                <h2 id="effective-lorebooks" data-translate-key="effectiveTitle">Как создавать эффективные лорбуки?</h2>
                <p data-translate-key="effectiveText">Одним из ключевых аспектов создания лорбуков является выбор структуры данных. Выделяется два основных подхода, мы о них уже говорили в разделе создания персонажей:</p>
                <ol>
                    <li data-translate-key="approach1"><strong>PLists</strong> - это упрощенный формат для описания объектов и их свойств в границах квадратных скобочек. Например, <code>[Novigrad (Free City): the city-state and the largest human settlement in the Northern Kingdoms, located in the delta of the Pontar River in the territory of the Kingdom of Redania, there are (tavern, bank, hotel, castle), kind people, rich]</code>. Для ключей используйте любые слова, которые ассоциируются с местом. В одной записи можно прилагать несколько ключей, таким образом программа сможет использовать одну и ту же запись на нескольких ключевых словах.</li>
                    <li data-translate-key="approach2"><strong>Ali:Chat</strong>, как мы уже знаем, используется для предоставления примеров диалогов, показывающих, как персонаж может реагировать на определенные элементы мира. Вы можете сделать текст записи в виде краткого диалог между пользователем и персонажем, который будет реагировать на какое-то событие.</li>
                </ol>
                
                <p data-translate-key="tipsText">Множество PList записей имеет высокую вероятность вызывать утечку скобок - это когда квадратные скобки, используемые для форматирования данных, неправильно обрабатываются языковой моделью и становятся видимыми в генерируемом тексте. Сохраняйте записи лорбуков краткими и информативными, устанавливайте подходящую глубину сканирования (в пределах от 2 до 5 сообщений, для сценариев с приключениями можете повысить до 15). Не перегружайте лорбуки избыточной информацией - сосредоточьтесь на самом важном.</p>
                
                <p data-translate-key="structureRecommendation">Для эффективных ролевых игр с языковой моделью рекомендуется использовать следующую структуру лорбука: для начала выберите основную категорию записи (место, персонаж, организация, история, культура, технологии или магия), а потом для каждого элемента напишите краткое описание в формате PList, пример диалога или реакции персонажа на этот элемент, ключевые слова, которые активируют запись.</p>
                
                <p data-translate-key="conclusionText">Лорбуки - это не панацея, однако важно с ними экспериментировать дабы выработать идеальный способ использовать их. Эффективное использование лорбуков требует баланса между детализацией и экономией токенов, тщательного выбора ключевых слов и понимания того, как информация вставляется в промпт модели. С правильной настройкой лорбуки могут значительно улучшить качество генерации, сделать ваши ролевые игры более глубокими и увлекательными и позволить вашим персонажам помнить важные детали из диалога даже при длительных чатах.</p>
                
                <p data-translate-key="nextSectionText">Следующий раздел будет посвящен модулю умной памяти, который является очередной важной оптимизацией потребления токенов языковой моделью.</p>
                
                <div class="pagination">
                    <a href="../system-prompt/system-prompt.html" class="pagination-link pagination-prev">
                        <i class="fas fa-arrow-left"></i> <span class="pagination-prev-text" data-translate-key="paginationPrev">Системный промпт</span>
                    </a>
                    <a href="../smart-memory/smart-memory.html" class="pagination-link pagination-next">
                        <span class="pagination-next-text" data-translate-key="paginationNext">Умная Память</span> <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </main>
    </div>
    <footer>
        <div class="footer-content">
            <p class="copyright-text" data-translate-key="copyrightText">&copy; 2025 Soul of Waifu. Разработал jofizcd.</p>
        </div>
    </footer>
    <script>
        const translations = {
            ru: {
                pageTitle: "Лорбуки - Документация Soul of Waifu",
                githubTitle: "GitHub",
                discordTitle: "Discord",
                sidebarTitle: "Содержание",
                sidebarIntroduction: "Введение",
                sidebarInstallation: "Установка",
                sidebarQuickStart: "Быстрый старт",
                sidebarCharacterCreation: "Создание персонажей",
                sidebarLlmSetup: "Настройка моделей",
                sidebarTtsStt: "Озвучка",
                sidebarAvatars: "Аватары персонажей",
                sidebarCourseTitle: "Вводный курс в AI RP",
                sidebarCourseLlm: "Всё про LLM",
                sidebarCoursePersona: "Персона",
                sidebarCourseSystemPrompt: "Системный промпт",
                sidebarCourseLorebooks: "Лорбуки",
                sidebarCourseSmartMemory: "Умная Память",
                sidebarCourseSoulSystem: "Soul of Waifu System",
                sidebarDevelopmentTitle: "Развитие программы",
                sidebarCommunity: "Сообщество",
                sidebarSupport: "Поддержать автора",
                docTitle: "Лорбуки",
                docIntro: "Лорбуки (также известные как Информация о Мире или Книги Знаний) - это мощный инструмент для динамического управления контекстом в задачах взаимодействия с языковыми моделями. Это не просто статическая энциклопедия мира, а активный компонент, который динамически вставляет релевантную информацию в промпт модели в зависимости от текущего контекста разговора. Лорбуки функционируют как динамический словарь, который активирует и вставляет соответствующую информацию только тогда, когда ключевые слова, связанные с записями, присутствуют в тексте сообщения. Представим себе лорбук о мире какого-то аниме. Если в чате проскальзывает имя персонажа или какое-то событие, то языковая модель вместо того, чтобы брать эту информацию из перегруженной карточки персонажа, вытаскивает записи из лорбука, в которых фигурирует имя или событие, а к этим записям прикреплен текст, который описывает упомянутое ранее имя, событие или что-либо другое. Таким образом мы серьезно облегчаем нагрузку на модель, ведь новые данные добавляются в контекст динамически и при ненадобности оттуда удаляются.",
                lorebooksPurpose: "Лорбуки по своей природе созданы для того, чтобы:",
                purpose1: "Добавлять в контекст чата информацию о мире, персонажах, событиях или локациях",
                purpose2: "Предотвращать забывание важных деталей по мере увеличения истории чата",
                purpose3: "Увеличивать погружение в ролевые игры с языковой моделью",
                purpose4: "Обеспечивать более точную и соответствующую контексту генерацию текста персонажа",
                purpose5: "Экономить токены контекста за счет вставки информации только по мере необходимости",
                lorebooksImportant: "Важно! Наличие лорбуков не гарантирует появления определенной информации в генерируемом тексте - это зависит от способности модели использовать дополнительную информацию.",
                structureTitle: "Структура Лорбуков",
                structureText: "Лорбуки состоят из отдельных записей, каждая из которых имеет следующие компоненты:",
                component1: "Ключи (Keys) - это список ключевых слов, которые активируют вставку записи в промпт. Ключи не чувствительны к регистру.",
                component2: "Содержание записи (Entry Content) - это текст, который вставляется в промпт при активации записи. Это может быть описание локации, детали о персонаже, исторические факты, правила мира или любая другая информация, которая должна быть доступна модели при генерации ответа. Важно помнить, что содержание должно быть кратким и информативным. Поскольку общий объем контекста ограничен, рекомендуется сохранять записи лаконичными, чтобы эффективно использовать доступные токены.",
                component3: "Глубина сканирования - это настройка, которая определяет число сообщений в истории чата, в которых программа будет искать ключевые слова из добавленных в лорбук записей.",
                effectiveTitle: "Как создавать эффективные лорбуки?",
                effectiveText: "Одним из ключевых аспектов создания лорбуков является выбор структуры данных. Выделяется два основных подхода, мы о них уже говорили в разделе создания персонажей:",
                approach1: "PLists - это упрощенный формат для описания объектов и их свойств в границах квадратных скобочек. Например, [Novigrad (Free City): the city-state and the largest human settlement in the Northern Kingdoms, located in the delta of the Pontar River in the territory of the Kingdom of Redania, there are (tavern, bank, hotel, castle), kind people, rich]. Для ключей используйте любые слова, которые ассоциируются с местом. В одной записи можно прилагать несколько ключей, таким образом программа сможет использовать одну и ту же запись на нескольких ключевых словах.",
                approach2: "Ali:Chat, как мы уже знаем, используется для предоставления примеров диалогов, показывающих, как персонаж может реагировать на определенные элементы мира. Вы можете сделать текст записи в виде краткого диалог между пользователем и персонажем, который будет реагировать на какое-то событие.",
                tipsText: "Множество PList записей имеет высокую вероятность вызывать утечку скобок - это когда квадратные скобки, используемые для форматирования данных, неправильно обрабатываются языковой моделью и становятся видимыми в генерируемом тексте. Сохраняйте записи лорбуков краткими и информативными, устанавливайте подходящую глубину сканирования (в пределах от 2 до 5 сообщений, для сценариев с приключениями можете повысить до 15). Не перегружайте лорбуки избыточной информацией - сосредоточьтесь на самом важном.",
                structureRecommendation: "Для эффективных ролевых игр с языковой моделью рекомендуется использовать следующую структуру лорбука: для начала выберите основную категорию записи (место, персонаж, организация, история, культура, технологии или магия), а потом для каждого элемента напишите краткое описание в формате PList, пример диалога или реакции персонажа на этот элемент, ключевые слова, которые активируют запись.",
                conclusionText: "Лорбуки - это не панацея, однако важно с ними экспериментировать дабы выработать идеальный способ использовать их. Эффективное использование лорбуков требует баланса между детализацией и экономией токенов, тщательного выбора ключевых слов и понимания того, как информация вставляется в промпт модели. С правильной настройкой лорбуки могут значительно улучшить качество генерации, сделать ваши ролевые игры более глубокими и увлекательными и позволить вашим персонажам помнить важные детали из диалога даже при длительных чатах.",
                nextSectionText: "Следующий раздел будет посвящен модулю умной памяти, который является очередной важной оптимизацией потребления токенов языковой моделью.",
                paginationPrev: "Системный промпт",
                paginationNext: "Умная Память",
                copyrightText: "© 2025 Soul of Waifu. Разработал jofizcd."
            },
            en: {
                pageTitle: "Lorebooks - Soul of Waifu Documentation",
                githubTitle: "GitHub",
                discordTitle: "Discord",
                sidebarTitle: "Table of Contents",
                sidebarIntroduction: "Introduction",
                sidebarInstallation: "Installation",
                sidebarQuickStart: "Quick Start",
                sidebarCharacterCreation: "Character Creation",
                sidebarLlmSetup: "LLM Setup",
                sidebarTtsStt: "Text-to-Speech",
                sidebarAvatars: "Character Avatars",
                sidebarCourseTitle: "Introduction to AI RP",
                sidebarCourseLlm: "All About LLMs",
                sidebarCoursePersona: "Persona",
                sidebarCourseSystemPrompt: "System Prompt",
                sidebarCourseLorebooks: "Lorebooks",
                sidebarCourseSmartMemory: "Smart Memory",
                sidebarCourseSoulSystem: "Soul of Waifu System",
                sidebarDevelopmentTitle: "Program Support",
                sidebarCommunity: "Community",
                sidebarSupport: "Support the Author",
                docTitle: "Lorebooks",
                docIntro: "Lorebooks (also known as World Information or Knowledge Books) are a powerful tool for dynamic context management in language model interaction tasks. This is not just a static encyclopedia of the world, but an active component that dynamically inserts relevant information into the model prompt depending on the current conversation context. Lorebooks function as a dynamic dictionary that activates and inserts relevant information only when keywords associated with entries are present in the message text. Let's imagine a lorebook about the world of some anime. If a character's name or some event slips into the chat, the language model instead of taking this information from the overloaded character card, extracts entries from the lorebook where the name or event is mentioned, and text is attached to these entries that describes the previously mentioned name, event or something else. Thus, we significantly reduce the load on the model, since new data is added to the context dynamically and removed when not needed.",
                lorebooksPurpose: "Lorebooks by their nature are created to:",
                purpose1: "Add information about the world, characters, events or locations to the chat context",
                purpose2: "Prevent forgetting important details as chat history increases",
                purpose3: "Increase immersion in role-playing games with a language model",
                purpose4: "Provide more accurate and context-appropriate character text generation",
                purpose5: "Save context tokens by inserting information only when needed",
                lorebooksImportant: "Important! The presence of lorebooks does not guarantee the appearance of certain information in the generated text - this depends on the model's ability to use additional information.",
                structureTitle: "Lorebooks Structure",
                structureText: "Lorebooks consist of individual entries, each of which has the following components:",
                component1: "Keys - this is a list of keywords that activate the insertion of an entry into the prompt. Keys are case-insensitive.",
                component2: "Entry Content - this is the text that is inserted into the prompt when an entry is activated. This can be a description of a location, details about a character, historical facts, world rules or any other information that should be available to the model when generating a response. It is important to remember that the content should be brief and informative. Since the total context volume is limited, it is recommended to keep entries concise to efficiently use available tokens.",
                component3: "Scan Depth - this is a setting that determines the number of messages in the chat history in which the program will search for keywords from the entries added to the lorebook.",
                effectiveTitle: "How to create effective lorebooks?",
                effectiveText: "One of the key aspects of creating lorebooks is choosing a data structure. There are two main approaches, which we have already discussed in the character creation section:",
                approach1: "PLists - this is a simplified format for describing objects and their properties within square brackets. For example, [Novigrad (Free City): the city-state and the largest human settlement in the Northern Kingdoms, located in the delta of the Pontar River in the territory of the Kingdom of Redania, there are (tavern, bank, hotel, castle), kind people, rich]. For keys, use any words associated with the place. Multiple keys can be attached to one entry, so the program can use the same entry on multiple keywords.",
                approach2: "Ali:Chat, as we already know, is used to provide examples of dialogues showing how a character can react to certain elements of the world. You can make the entry text in the form of a brief dialogue between the user and the character who will react to some event.",
                tipsText: "A large number of PList entries have a high probability of causing bracket leakage - this is when square brackets used for data formatting are incorrectly processed by the language model and become visible in the generated text. Keep lorebook entries brief and informative, set an appropriate scan depth (within 2 to 5 messages, for adventure scenarios you can increase to 15). Do not overload lorebooks with excessive information - focus on what is most important.",
                structureRecommendation: "For effective role-playing games with a language model, it is recommended to use the following lorebook structure: first, select the main entry category (place, character, organization, history, culture, technology or magic), and then for each element, write a brief description in PList format, an example of dialogue or character reaction to this element, keywords that activate the entry.",
                conclusionText: "Lorebooks are not a panacea, but it is important to experiment with them to develop the perfect way to use them. Effective use of lorebooks requires a balance between detail and token savings, careful keyword selection, and understanding how information is inserted into the model prompt. With proper setup, lorebooks can significantly improve generation quality, make your role-playing games deeper and more engaging, and allow your characters to remember important details from the dialogue even during long chats.",
                nextSectionText: "The next section will be devoted to the smart memory module, which is another important optimization of language model token consumption.",
                paginationPrev: "System Prompt",
                paginationNext: "Smart Memory",
                copyrightText: "© 2025 Soul of Waifu. Developed by jofizcd."
            }
        };
        function saveSettings(settings) {
            try {
                localStorage.setItem('soulofwaifu_settings', JSON.stringify(settings));
            } catch (e) {
                console.warn("Не удалось сохранить настройки в localStorage:", e);
            }
        }
        function loadSettings() {
            try {
                const settingsStr = localStorage.getItem('soulofwaifu_settings');
                if (settingsStr) {
                    return JSON.parse(settingsStr);
                }
            } catch (e) {
                console.warn("Не удалось загрузить настройки из localStorage:", e);
            }
            return { theme: 'dark', language: 'ru' };
        }
        function applySettings(settings) {
            if (settings.theme === 'light') {
                document.body.classList.add('light-theme');
                const logoDark = document.querySelector('.logo-dark');
                const logoLight = document.querySelector('.logo-light');
                if (logoDark) logoDark.style.display = 'none';
                if (logoLight) logoLight.style.display = 'block';
            } else {
                document.body.classList.remove('light-theme');
                const logoDark = document.querySelector('.logo-dark');
                const logoLight = document.querySelector('.logo-light');
                if (logoDark) logoDark.style.display = 'block';
                if (logoLight) logoLight.style.display = 'none';
            }
            updateLanguage(settings.language);
            if (document.getElementById('languageSelector')) {
                document.getElementById('languageSelector').value = settings.language;
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', function() {
                    document.body.classList.toggle('light-theme');
                    const logoDark = document.querySelector('.logo-dark');
                    const logoLight = document.querySelector('.logo-light');
                    if (document.body.classList.contains('light-theme')) {
                        if (logoDark) logoDark.style.display = 'none';
                        if (logoLight) logoLight.style.display = 'block';
                    } else {
                        if (logoDark) logoDark.style.display = 'block';
                        if (logoLight) logoLight.style.display = 'none';
                    }
                    const currentLang = document.getElementById('languageSelector') ? document.getElementById('languageSelector').value : 'ru';
                    const currentTheme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
                    saveSettings({ theme: currentTheme, language: currentLang });
                });
            }
            const languageSelector = document.getElementById('languageSelector');
            if (languageSelector) {
                languageSelector.addEventListener('change', function() {
                    const selectedLang = this.value;
                    updateLanguage(selectedLang);
                    const currentTheme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
                    saveSettings({ theme: currentTheme, language: selectedLang });
                });
            }
            const savedSettings = loadSettings();
            applySettings(savedSettings);
            const currentPagePath = window.location.pathname; 
            const sidebarLinks = document.querySelectorAll('.doc-sidebar a');
            sidebarLinks.forEach(link => {
                try {
                    const linkPath = new URL(link.href, window.location.origin).pathname;
                    link.classList.remove('active');
                    if (currentPagePath === linkPath || 
                        currentPagePath === linkPath.replace('/index.html', '/') ||
                        (currentPagePath.endsWith('/') && linkPath.endsWith('/index.html')) ||
                        (currentPagePath === '/' && linkPath.includes('overview.html'))) {
                        link.classList.add('active');
                    }
                } catch (e) {
                    if (link.getAttribute('href').startsWith('#')) {
                        const currentHash = window.location.hash;
                        if (link.getAttribute('href') === currentHash) {
                            link.classList.add('active');
                        }
                    }
                }
            });
        });
        function updateLanguage(lang) {
            const t = translations[lang];
            if (!t) return;
            document.querySelectorAll('[data-translate-key]').forEach(element => {
                const key = element.getAttribute('data-translate-key');
                if (t[key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = t[key];
                    } else {
                        element.textContent = t[key];
                    }
                }
            });
            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (t[key]) {
                    element.placeholder = t[key];
                }
            });
            document.querySelectorAll('[data-translate-title]').forEach(element => {
                const key = element.getAttribute('data-translate-title');
                if (t[key]) {
                    element.title = t[key];
                }
            });
            document.querySelectorAll('[data-translate-alt]').forEach(element => {
                const key = element.getAttribute('data-translate-alt');
                if (t[key]) {
                    element.alt = t[key];
                }
            });
            const prevLink = document.querySelector('.pagination-prev');
            if (prevLink) {
                prevLink.innerHTML = `<i class="fas fa-arrow-left"></i> ${t.paginationPrev || 'Installation'}`;
            }
            const nextLink = document.querySelector('.pagination-next');
            if (nextLink) {
                nextLink.innerHTML = `${t.paginationNext || 'Character Creation'} <i class="fas fa-arrow-right"></i>`;
            }
            document.title = t.pageTitle || "Lorebooks - Soul of Waifu Documentation";
        }
    </script>
</body>
</html>
